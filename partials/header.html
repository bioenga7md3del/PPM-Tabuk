<!-- partials/header.html -->
<header class="px-3 md:px-6 mt-3">
  <div class="topbar px-3 md:px-4 py-2 flex items-center justify-between rounded-xl bg-gradient-to-r from-sky-600 to-blue-600 shadow">
    <!-- LEFT: Nav -->
    <nav id="mainNav" class="relative flex items-center gap-2 md:gap-3 text-white text-[15px] md:text-[16px] font-medium">

      <!-- Dashboard -->
      <a href="/PPM-Tabuk/modules/dashboard/index.html" data-to="dashboard"
         class="toplink inline-flex items-center gap-2 px-2 py-1 rounded-md hover:bg-white/15">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/>
        </svg>
        <span>Dashboard</span>
      </a>

      <!-- Assets -->
      <a href="/PPM-Tabuk/modules/assets/index.html" data-to="assets"
         class="toplink inline-flex items-center gap-2 px-2 py-1 rounded-md hover:bg-white/15">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 7l9-4 9 4-9 4-9-4z"/><path d="M21 7v8l-9 4-9-4V7"/>
        </svg>
        <span>Assets</span>
      </a>

      <!-- Preventive -->
      <a href="/PPM-Tabuk/modules/preventive/index.html" data-to="preventive"
         class="toplink inline-flex items-center gap-2 px-2 py-1 rounded-md hover:bg-white/15">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2l7 4v5c0 5-3 9-7 11-4-2-7-6-7-11V6l7-4z"/><path d="M9 12l2 2 4-4"/>
        </svg>
        <span>Preventive</span>
      </a>

      <!-- Corrective (dropdown) -->
      <div class="dd relative" data-dd="corrective">
        <button type="button" class="toplink dd-btn inline-flex items-center gap-2 px-2 py-1 rounded-md hover:bg-white/15">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14.7 6.3a4 4 0 1 0-5.4 5.4L3 18v3h3l6.3-6.3a4 4 0 0 0 5.4-5.4z"/>
          </svg>
          <span>Corrective</span>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="dd-panel" role="menu" aria-hidden="true">
          <a class="dd-item" href="/PPM-Tabuk/modules/corrective/index.html?tab=ticket" data-to="corrective">
            <span>📝</span><span>Ticket</span>
          </a>
          <a class="dd-item" href="/PPM-Tabuk/modules/spares/index.html" data-to="spares">
            <span>⚙️</span><span>SparePart</span>
          </a>
          <a class="dd-item" href="/PPM-Tabuk/modules/corrective/index.html?tab=wo" data-to="corrective">
            <span>📄</span><span>WorkOrder</span>
          </a>
        </div>
      </div>

      <!-- Sites (dropdown + link) -->
      <div class="dd relative" data-dd="sites">
        <a href="/PPM-Tabuk/modules/sites/index.html" class="toplink inline-flex items-center gap-2 px-2 py-1 rounded-md hover:bg-white/15" data-to="sites">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 21s-6-5.3-6-10a6 6 0 1 1 12 0c0 4.7-6 10-6 10z"/><circle cx="12" cy="11" r="3"/>
          </svg>
          <span>Sites</span>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </a>
        <div class="dd-panel" role="menu" aria-hidden="true">
          <a class="dd-item" href="/PPM-Tabuk/modules/sites/departments.html" data-to="sites">
            <span>🏷️</span><span>Department</span>
          </a>
          <a class="dd-item" href="/PPM-Tabuk/modules/sites/rooms.html" data-to="sites">
            <span>🏠</span><span>Rooms</span>
          </a>
        </div>
      </div>

      <!-- Users -->
      <a href="/PPM-Tabuk/modules/users/index.html" data-to="users"
         class="toplink inline-flex items-center gap-2 px-2 py-1 rounded-md hover:bg-white/15">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <span>Users</span>
      </a>
    </nav>

    <!-- RIGHT: user + theme + logout -->
    <div class="flex items-center gap-2 md:gap-3 flex-row-reverse">
      <button id="btnLogout" class="px-3 py-1 rounded-lg bg-red-600 hover:bg-red-700 text-white">Logout</button>
      <button id="themeBtn" onclick="toggleTheme()" title="Toggle Theme"
        class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/30 text-white shadow transition">🌓</button>
      <a id="userName" class="font-semibold text-white hover:underline cursor-pointer"
         href="/PPM-Tabuk/modules/users/index.html#settings" title="User settings"></a>
      <span class="text-white/60">|</span>
    </div>
  </div>

  <style>
    /* Active top-level link = أحمر فقط للنص */
    #mainNav .toplink.is-active span { color:#fecaca !important; } /* red-200 */
    #mainNav .toplink.is-active { background-color: transparent !important; }

    /* Dropdown panel — ثابت ومقروء */
    #mainNav .dd { position: relative; }
    #mainNav .dd .dd-panel{
      position:absolute; top:100%; left:0; z-index:50;
      display:none; min-width:220px;
      background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.08);
      padding:.5rem; color:#1f2937; /* text-slate-800 */
    }
    #mainNav .dd.open .dd-panel{ display:block; }
    #mainNav .dd .dd-item{
      display:flex; align-items:center; gap:.6rem;
      padding:.6rem .75rem; border-radius:.6rem;
      color:#1f2937; text-decoration:none; font-weight:600;
      white-space:nowrap;
    }
    #mainNav .dd .dd-item:hover{ background:#f1f5f9; color:#1d4ed8; }
  </style>

  <script>
    // Dropdown logic (click to toggle; click outside or Esc to close)
    (function(){
      const nav = document.getElementById('mainNav');
      function closeAll(){ nav.querySelectorAll('.dd.open').forEach(x=>x.classList.remove('open')); }
      nav.addEventListener('click', (e)=>{
        const btn = e.target.closest('.dd-btn');
        if(!btn) return;
        const dd = btn.closest('.dd');
        if(!dd) return;
        const open = dd.classList.contains('open');
        closeAll();
        if(!open) dd.classList.add('open');
      });
      document.addEventListener('click', (e)=>{
        if(!e.target.closest('#mainNav .dd')) closeAll();
      });
      document.addEventListener('keydown', (e)=>{
        if(e.key==='Escape') closeAll();
      });
    })();
  </script>
</header>
